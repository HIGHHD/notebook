# 监控

所有服务的状态，0,1，时间，服务标识，massage

每次采集和数据备份任务是否成功的状态 （0,1,-1），采集开始时间，结束时间，采集任务标识，massage，若未开始采集或备份，则状态为-1，任务失败或未开始，end_time传null

数据库连通性测试状态 （0,1），时间，数据库连接串，massage

监控服务要和其他被监控服务分开，不能置于同一个服务内

监控接口api返回json，每次调用返回此次检测结果即可，每种监控提供一个路径，提供GET方法即可

监控服务api和返回值示例如下：

**服务状态** http://监控地址/services

```json
[
    {
        name: "服务1",
        time: "2021-09-06 08:00:00",
        stauts: 0,
        msg: "Error,数据"
    },
    {
        name: "服务1",
        time: "2021-09-06 08:00:00",
        stauts: 1，
        msg: "服务正常"
    }
]
```
**每个服务状态** http://监控地址/service/<标识名>

```json
 {
     name: "服务1",
     time: "2021-09-06 08:00:00",
     stauts: 0,
     msg: "Error,数据"
 }
```

**采集或备份任务** http://监控地址/jobs

```json
[
    {
        name: "采集任务1",
        start_time: "2021-09-06 08:00:00",
        end_time: "2021-09-06 08:00:00",
        stauts: 1，
        msg: "采集完成"
    },
    {
        name: "数据备份任务1",
        start_time: "2021-09-06 08:00:00",
        end_time: "2021-09-06 08:00:00",
        stauts: -1，
        msg: "备份未开始"
    }
]
```

**每个服务状态** http://监控地址/job/<标识名>

```json
{
    name: "采集任务1",
    start_time: "2021-09-06 08:00:00",
    end_time: "2021-09-06 08:00:00",
    stauts: 1，
    msg: "采集完成"
}
```

**数据库联通性测试**，dsn具体形式无要求，能标识到数据库就可以

http://监控地址/dbs

```json
[
    {
        dsn: "pgsql:host=localhost;port=5432;dbname=testdb;user=bruce;",
        time: "2021-09-06 08:00:00",
        stauts: 1,
        msg: "连接成功"
    },
    {
        dsn: "mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]",
        time: "2021-09-06 08:00:00",
        stauts: 1,
        msg: "连接成功"
    }
]
```

