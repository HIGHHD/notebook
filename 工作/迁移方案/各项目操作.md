1. tomcat:jre8-openjdk-slim-buster，用于部署所有tomcat项目，启动后将war包和前端项目考入webapps目录下
   1. CMDB平台
   2. 报表中心（固定收益报表）
   3. 隔离墙系统
2. kong:2.5.0-alpine、pantsel/konga:0.14.9
   1. kong
3. webdevops/php-apache:7.1
   1. 收益凭证网站
4. openjdk:8u302-jre-slim-buster，用于部署springboot项目的jar包，同一项目的jar包，使用shell统一启动
   1. 首创基础消息应用系统
   2. 首创企业微信消息应用系统
   3. 首创身份认证与授权管理应用
5. gitlab/gitlab-ce:14.1.2-ce.0
   1. 用于部署gitlab



## 身份认证和授权

进入父工程(hurricane-sso)的pom文件所在目录，打包编译，将依赖包放至本地仓库

```
mvn clean install package -Dmaven.test.skip
```
分别进入各模块（hurricane-ldap/hurricane-jwt/hurricane-auth/hurricane-admin）目录， 构建Docker镜像,，这步不需要了

```
mvn package docker:build -Dmaven.test.skip -Pdev -U        //直接构建docker镜像
mvn clean install -Dmaven.test.skip -Pdev -U
```

打包后确认jar包下的application.yml active 版本

```
docker volume create --name=spring-jar    // 挂载卷
# 个人电脑
scp N:\codes_workspace\javaprojects\hurricane-sso\hurricane-*\target\hurricane-*-2.1.jar root@192.168.202.59:\var\lib\docker\volumes\spring-jar\_data

rm -f hurricane-common-2.1.jar hurricane-service-2.1.jar hurricane-util-2.1.jar
```

```
FROM openjdk:8u302-jre-slim-buster

COPY localtime /etc/
RUN echo "Asia/Shanghai" > /etc/timezone

WORKDIR /home
CMD ["bash"]
```

```
version: "3"
networks:
  bridge_net_0:
    external: true
volumes:
  spring-jar:
    external: true  
x-spring-jar: &spring-jar
  image: "sczq-jre:v1"
  networks:
    - bridge_net_0
  volumes:
    - spring-jar:/home
services:
  hurricane-auth:
    <<: *spring-jar
    container_name: hurricane-auth
    command: "java -jar /home/hurricane-auth-2.1.jar"
    ports:
      - "9969:9969"
  hurricane-jwt:
    <<: *spring-jar
    container_name: hurricane-jwt
    command: "java -jar /home/hurricane-jwt-2.1.jar"
    ports:
      - "9968:9968"
  hurricane-ldap:
    <<: *spring-jar
    container_name: hurricane-ldap
    command: "java -jar /home/hurricane-ldap-2.1.jar"
    ports:
      - "9967:9967"
  hurricane-admin:
    <<: *spring-jar
    container_name: hurricane-admin
    command: "java -jar /home/hurricane-admin-2.1.jar"
    ports:
      - "9970:9970"
  wechat-service:
    <<: *spring-jar
    container_name: wechat-service
    command: "java -jar /home/wechat-service-1.jar"
    ports:
      - "8012:8012"
  wechat-mq:
    image: rabbitmq:3-management
    container_name: wechat-mq
    environment:
      RABBITMQ_DEFAULT_USER: "wechat"
      RABBITMQ_DEFAULT_PASS: "Wechat@1234"
    networks:
      - bridge_net_0
    expose:
      - "5672"
    ports:
      - "15672:15672"
  mail-service:
    <<: *spring-jar
    container_name: mail-service
    command: "java -jar /home/mail-service-1.jar"
    ports:
      - "8015:8015"
  sms-service:
    <<: *spring-jar
    container_name: sms-service
    command: "java -jar /home/sms-service-1.jar"
    ports:
      - "8016:8016"
    
```

## 公共tomcat，消息

```
docker volume create --name=spring-jar    // 挂载卷
docker volume create --name=tomcat-war
# 个人电脑
scp N:\codes_workspace\javaprojects\sms-service-boot\target\*.jar root@192.168.202.59:\var\lib\docker\volumes\spring-jar\_data

scp N:\codes_workspace\javaprojects\mail-service\target\*.jar root@192.168.202.59:\var\lib\docker\volumes\spring-jar\_data

scp N:\codes_workspace\javaprojects\wechat-service-boot\target\*.jar root@192.168.202.59:\var\lib\docker\volumes\spring-jar\_data

拷贝前改名为wechat-base.war，或拷贝前关闭docker，改名后重启
scp N:\codes_workspace\javaprojects\wechat-base\target\*.war root@192.168.202.59:\var\lib\docker\volumes\tomcat-war\_data
```

```
FROM tomcat:8.5-jre8-openjdk-slim-buster

COPY localtime /etc/
RUN echo "Asia/Shanghai" > /etc/timezone

WORKDIR /usr/local/tomcat
CMD ["catalina.sh", "run"]
```

```
version: "3"
networks:
  bridge_net_0:
    external: true
volumes:
  tomcat-war:
    external: true  
services:
  tomcat:
    image: "sczq-tomcat:v1"
    container_name: tomcat-all
    environment:
      - TZ="Asia/Shanghai"
    networks:
      - bridge_net_0
    volumes:
      - tomcat-war:/usr/local/tomcat/webapps
    ports:
      - "8080:8080"
```

## 固收报表

```
 scp N:\codes_workspace\javaprojects\dmp\target\*.war root@192.168.202.59:\var\lib\docker\volumes\tomcat-war\_data
report-dmp-1.war


```

## nginx、php、uwsgi

用于server 文档中心，前后台，固收、隔离墙、

docker pull php:8.0.11-fpm-alpine3.14                    /usr/local/etc 是配置文件位置

