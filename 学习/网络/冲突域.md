



在了解冲突域之前，我们先了解一下什么是共享式局域网？共享式局域网内的主机使用的传输介质是同一根同轴电缆，这里的同轴电缆又叫做共享介质。在共享式网络中，不同的主机进行数据通信时，共享传输介质，这样就会产生信号冲突的问题，并且一台主机发送数据时其他主机都能收到，就产生了广播域，同时传输数据的安全性也得不到保证。

冲突域是共享式网络中产生信号冲突的现象。

怎么解决冲突域呢？解决冲突域的方法通常是采用CSMA/CD(载波侦听多路访问/冲突检测)，这个方法有四个步骤分别是：第一，先听后发，当一个主机要传输数据时，先不停地对共享线路进行检测，如果线路上没有信号传输，则发送数据，如果有，则等待一段时间后在继续检测发送。第二，边听边发，在发送的过程中同时也检测线路。第三，冲突停发，如果有检测到冲突，发送设备会立即停止发送数据，并发送阻塞信号，通知其他设备，使其他设备尽早的检测到冲突。



在[以太网](https://baike.baidu.com/item/以太网/99684)中，如果某个[CSMA/CD](https://baike.baidu.com/item/CSMA%2FCD)网络上的两台计算机在同时通信时会发生冲突，那么这个CSMA/CD网络就是一个冲突域（collision domain)。如果[以太网](https://baike.baidu.com/item/以太网/99684)中各个[网段](https://baike.baidu.com/item/网段/11026985)以集线器连接，因为不能避免冲突，所以它们仍然是一个冲突域。



一个交换机端口一个冲突域，一个网段一个广播域，划分vlan后，一个vlan一个广播域



冲突域（物理分段）：连接在同一导线上的所有工作站的集合，或者说是同一物理网段上所有节点的集合或以太网上竞争同一带宽的节点集合。这个域代表了冲突在其中发生并传播的区域，这个区域可以被认为是共享段。在OSI模型中，冲突域被看作是第一层的概念，连接同一冲突域的设备有Hub，Reperter或者其他进行简单复制信号的设备。也就是说，用Hub或者Repeater连接的所有节点可以被认为是在同一个冲突域内，它不会划分冲突域。而第二层设备（网桥，交换机）第三层设备（路由器）都可以划分冲突域的，当然也可以连接不同的冲突域。简单的说，可以将Repeater等看成是一根电缆，而将网桥等看成是一束电缆。



为了有效避免冲突，局域网中使用[交换机](https://baike.baidu.com/item/交换机)（Switch）来分割冲突域。对网络进行分割的原因是为了分离流量并创建更小的冲突域来使用户获得更高的带宽，否则同一时刻数据太多容易导致网络拥挤形成阻塞。



### 转载

很久很久以前，原始社会的人都生活在山洞里，这个山洞构造是这样的，每个人住在自己的洞穴里，洞穴的中间只有一个狭长的走廊，只能容纳一人通过（两人无法通行），平时出去打猎，老大会喊一嗓子：有出去打猎的吗？其他人都听得到，这个就是一个广播域。大壮听到了回应：老大，我想去打猎，等等我！于是大壮就顺着狭长的通道走向老大的洞穴。

过一会，老二也喊一嗓子：有出去泡妞的吗？小色大叫：二哥，我要去！于是小色走向老二的洞穴，不巧的是在通道上与大壮狭路相逢，于是产生了冲突，这个就是冲突域。于是小色乖乖退后，大壮继续走到了老大的房间。小色见大壮进了老大的房间，才敢出门到老二的房间。

后来大家觉得这狭长的通道太不方便了，于是将山洞的中心拓宽了，变成了一个大客厅，每个洞穴都连着客厅，这样大家就不会再狭路相逢了，大壮去老大的房间，小色可以同时去老二的房间，通行效率大大提高。

山洞里还住着小美，有时老二会到小美的房间谈工作，小色也会到小美的房间谈生活、谈理想，但是通往小美的走道也只能容纳一人，老二与小色如果同时到达，老二不客气，径直进入房间，小色闷闷不乐回去了，等老二走了再去。

后来小美觉得让小色白跑一趟不好，于是在房间门口放了一凳子，准备了香烟茶点、瓜子橘子水，让小色稍等片刻，小色觉得这个服务很人性化，欣然接受，等老二谈完工作，再和小美聊天。

**正式开始话题**

最后小美使用的这项技术，就是交换机出接口的缓存队列，当发现出口有数据占据通道事，将其他的数据缓存下来，而不是丢弃，可以避免数据源主机重新发送。

大家先有一个感性认识，再来聊聊相关的话题，最早大家的电脑用一个HUB连接起来，HUB如果按照OSI模型来划分，只是一个物理层设备，因为它不对以太网帧做解释，只是将接收到的物理信号放大，然后从其他所有端口将信号广播出去，此为广播域。

由于HUB只是一个信号放大器，没有缓存机制，任何时刻只能有一台电脑发数据给HUB，如果有多台电脑同时发数据给HUB，会产生冲突，所以就有了CMSA/CD机制，为了避免冲突，大家发数据前，先听听HUB有没有数据在发送，如果没有，才可以发送。

很显然以上通信模式很落伍，于是有了交换机，交换机是二层设备，可以理解以太网帧的概念，可以学习每台电脑的MAC地址及对应端口，当交换机接收到一个帧，如果目的地址是广播地址、或不认识的MAC地址，依然会通过广播的方式发送出去，如果是认识的MAC地址，指挥发给对应的端口。

那盒交换机相连的电脑发送数据之前还需要侦听线路吗？不需要，因为现代交换机端口工作在全双工模式，直接发给叫花鸡就可以了，交换机直接进行交换，当然，每个交换机的端口任然是一个冲突域，吐过交换的出端口拥塞，用缓存队列处理这些数据，等出端口一空闲立马就发送。

但以上队列有一个问题，采用先进先出FIFO机制。如果就一个队列，低优先级的帧早于高优先级的帧先入队列，那低优先级的帧将先发送，这不符合服务质量QoS精神，应该高优先级的帧先发送，于是可以有多个优先级队列，将高优先级数据放在高优先级队列先发送

还有问题，如果端口1有去端口2的数据，也有去端口3的数据，但是端口2处于拥塞，排在前面的数据恰恰是去往端口2的，后面的数据急死了，因为端口3是空闲的，而前面的数据却因为端口2拥堵而在等待，这显然也不合理，于是就有了虚拟队列vQueue(VIrtual Queue)，比如这里的端口1有两个vQueue，一个通向端口2，一个通向端口3，互不干扰，即使端口2拥堵了，也不影响通往端口3数据的交换，数据交换效率会大大提升

